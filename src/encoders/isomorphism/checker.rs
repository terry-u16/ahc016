use std::cmp::Reverse;

use itertools::Itertools;
use ordered_float::OrderedFloat;

use crate::{graph::Graph, utils::decode_num_to_u64};

/// グラフの同型性を判定するトレイト
pub trait IsomophicChecker {
    /// 与えられたグラフが同型かどうか判定する
    fn is_isomorphic(&self, graph: &Graph) -> bool;
}

/// グラフの次数集合で同型性を判定（大嘘）する構造体
/// 実際は同型性判定はできないのだが、計算量が軽く十分な数のグラフを識別できる
#[allow(dead_code)]
#[derive(Debug, Clone)]
pub struct DegreeChecker {
    n: usize,
    degs: Vec<u32>,
    graph: Graph,
}

#[allow(dead_code)]
impl DegreeChecker {
    pub fn new(graph: &Graph) -> Self {
        let degs = Self::get_degs(graph);
        let n = graph.n;

        Self {
            n,
            degs,
            graph: graph.clone(),
        }
    }

    fn get_degs(graph: &Graph) -> Vec<u32> {
        let n = graph.n;
        let mut degs = vec![0; n];

        for i in 0..n {
            for j in (i + 1)..n {
                if graph[i][j] {
                    degs[i] += 1;
                    degs[j] += 1;
                }
            }
        }

        degs.sort_unstable();

        degs
    }
}

impl IsomophicChecker for DegreeChecker {
    fn is_isomorphic(&self, graph: &Graph) -> bool {
        let deg = Self::get_degs(graph);

        return self.degs == deg;
    }
}

/// VF2アルゴリズムによりグラフの同型性判定を行う構造体
/// テストを行った結果順列全探索だと時間がかかりすぎると思い込んでしまったために実装されたが、
/// そのテスト自体が間違っていたため本来不要だったという悲しい経歴を持つ
/// 参考: http://satemochi.blog.fc2.com/blog-entry-224.html
#[derive(Debug, Clone)]
pub struct Vf2Checker {
    n: usize,
    degs: Vec<u32>,
    graph: AdjacencyListGraph,
}

impl IsomophicChecker for Vf2Checker {
    fn is_isomorphic(&self, graph: &Graph) -> bool {
        if self.n != graph.n {
            return false;
        }

        let degs = Self::get_degs(&graph);

        if self.degs != degs {
            return false;
        }

        let graph = AdjacencyListGraph::from(graph);
        let mut map12 = vec![None; self.n];
        let mut map21 = vec![None; self.n];
        let mut neighs1 = vec![false; self.n];
        let mut neighs2 = vec![false; self.n];

        Self::isomophism_dfs(
            &self.graph,
            &graph,
            &mut map12,
            &mut map21,
            &mut neighs1,
            &mut neighs2,
            0,
        )
    }
}

impl Vf2Checker {
    pub fn new(graph: &Graph) -> Self {
        let n = graph.n;
        let degs = Self::get_degs(&graph);
        let graph = AdjacencyListGraph::from(graph);

        Self { n, degs, graph }
    }

    fn get_degs(graph: &Graph) -> Vec<u32> {
        let n = graph.n;
        let mut degs = vec![0; n];

        for i in 0..n {
            for j in (i + 1)..n {
                if graph[i][j] {
                    degs[i] += 1;
                    degs[j] += 1;
                }
            }
        }

        degs.sort_unstable();

        degs
    }

    fn isomophism_dfs(
        graph1: &AdjacencyListGraph,
        graph2: &AdjacencyListGraph,
        map12: &mut [Option<usize>],
        map21: &mut [Option<usize>],
        neighs1: &mut [bool],
        neighs2: &mut [bool],
        depth: usize,
    ) -> bool {
        let (vs1, v2) = Self::generate_candidates(graph1.n, map12, map21, neighs1, neighs2);
        let mut stack1 = vec![];
        let mut stack2 = vec![];

        for &v1 in vs1.iter() {
            let edges1 = &graph1.edges[v1];
            let edges2 = &graph2.edges[v2];

            if Self::is_syntactic_feasible(edges1, edges2, map12, map21, neighs1, neighs2) {
                if depth + 1 == graph1.n {
                    return true;
                }

                map12[v1] = Some(v2);
                map21[v2] = Some(v1);
                Self::update_neighs(graph1, neighs1, &mut stack1, v1);
                Self::update_neighs(graph2, neighs2, &mut stack2, v2);

                let found =
                    Self::isomophism_dfs(graph1, graph2, map12, map21, neighs1, neighs2, depth + 1);
                if found {
                    return true;
                }

                map12[v1] = None;
                map21[v2] = None;
                Self::restore_neighs(neighs1, &mut stack1);
                Self::restore_neighs(neighs2, &mut stack2);
            }
        }

        false
    }

    fn update_neighs(
        graph: &AdjacencyListGraph,
        neighs: &mut [bool],
        stack: &mut Vec<usize>,
        v: usize,
    ) {
        if !neighs[v] {
            neighs[v] = true;
            stack.push(v);
        }

        for &next in graph.edges[v].iter() {
            if !neighs[next] {
                neighs[next] = true;
                stack.push(next);
            }
        }
    }

    fn restore_neighs(neighs: &mut [bool], stack: &mut Vec<usize>) {
        while let Some(v) = stack.pop() {
            neighs[v] = false;
        }
    }

    /// 次に調べる(graph1の頂点列, graph2の頂点)の候補を列挙する
    fn generate_candidates(
        n: usize,
        map12: &[Option<usize>],
        map21: &[Option<usize>],
        neighs1: &[bool],
        neighs2: &[bool],
    ) -> (Vec<usize>, usize) {
        // グラフ1: 今まで見た頂点の隣接頂点であって、まだ確定していないものを列挙する
        // グラフ2: 今まで見た頂点の隣接頂点から適当に1つ選ぶ
        let candidates1 = (0..n)
            .filter(|&v| neighs1[v] && map12[v].is_none())
            .collect_vec();
        let v2 = (0..n).filter(|&v| neighs2[v] && map21[v].is_none()).min();

        // 候補が存在する場合
        if candidates1.len() > 0 {
            if let Some(v2) = v2 {
                return (candidates1, v2);
            }
        }

        // グラフが非連結の場合
        // v1は未確定の頂点全てを候補とし、v2は適当に1つ頂点を持ってきて決める
        let c1 = (0..n).filter(|&v| map12[v].is_none()).collect_vec();
        let v2 = (0..n).filter(|&v| map21[v].is_none()).min().unwrap();
        (c1, v2)
    }

    /// 新しく追加される頂点に隣接する頂点について、頂点相関の実行可能性を判定する
    ///
    /// - 確定済みの点について全単射に矛盾が起きないか
    /// - 隣接点集合に含まれる頂点の数が等しいか
    /// - 隣接点集合に含まれない頂点の数が等しいか
    ///
    /// についてチェック
    fn is_syntactic_feasible(
        edges1: &[usize],
        edges2: &[usize],
        map12: &[Option<usize>],
        map21: &[Option<usize>],
        neighs1: &[bool],
        neighs2: &[bool],
    ) -> bool {
        Self::are_valid_neighbor(edges1, edges2, map12, map21)
            && Self::have_same_inside_neighbors(edges1, edges2, map12, map21, neighs1, neighs2)
            && Self::have_same_outside_neighbors(edges1, edges2, neighs1, neighs2)
    }

    /// ある頂点(u, v)を加えたとき、全単射に矛盾が起きないか
    fn are_valid_neighbor(
        edges1: &[usize],
        edges2: &[usize],
        map12: &[Option<usize>],
        map21: &[Option<usize>],
    ) -> bool {
        if edges1.len() != edges2.len() {
            return false;
        }

        fn ok(my_map: &[Option<usize>], other_edges: &[usize], v: usize) -> bool {
            // v1が確定済みの場合、f(v1)=v2となるv2が相手側の辺にも存在しなければならない
            if let Some(v) = my_map[v] {
                other_edges.contains(&v)
            } else {
                true
            }
        }

        edges1.iter().all(|&v| ok(map12, edges2, v)) && edges2.iter().all(|&v| ok(map21, edges1, v))
    }

    /// neighs \ map について、edgesに含まれる頂点の個数が一致するか
    fn have_same_inside_neighbors(
        edges1: &[usize],
        edges2: &[usize],
        map12: &[Option<usize>],
        map21: &[Option<usize>],
        neighs1: &[bool],
        neighs2: &[bool],
    ) -> bool {
        fn count(edges: &[usize], map: &[Option<usize>], neighs: &[bool]) -> usize {
            edges
                .iter()
                .filter(|&&v| neighs[v] && map[v].is_some())
                .count()
        }

        count(edges1, map12, neighs1) == count(edges2, map21, neighs2)
    }

    /// G \ neighs について、edgesに含まれる頂点の個数が一致するか
    fn have_same_outside_neighbors(
        edges1: &[usize],
        edges2: &[usize],
        neighs1: &[bool],
        neighs2: &[bool],
    ) -> bool {
        fn count(edges: &[usize], neighs: &[bool]) -> usize {
            edges.iter().filter(|&&v| !neighs[v]).count()
        }

        count(edges1, neighs1) == count(edges2, neighs2)
    }
}

#[derive(Debug, Clone)]
struct AdjacencyListGraph {
    n: usize,
    edges: Vec<Vec<usize>>,
}

impl AdjacencyListGraph {
    fn new(n: usize) -> Self {
        Self {
            n,
            edges: vec![vec![]; n],
        }
    }

    fn add_edge(&mut self, u: usize, v: usize) {
        self.edges[u].push(v);
        self.edges[v].push(u);
    }
}

impl From<&Graph> for AdjacencyListGraph {
    fn from(graph: &Graph) -> Self {
        let mut adj_graph = AdjacencyListGraph::new(graph.n);

        for u in 0..graph.n {
            for v in (u + 1)..graph.n {
                if graph[u][v] {
                    adj_graph.add_edge(u, v);
                }
            }
        }

        adj_graph
    }
}

/// 互いに同型でないグラフをn個生成する
pub fn generate_isompic_graphs(n: usize, error_ratio: f64) -> (Vec<Graph>, usize) {
    for bits in 4..=6 {
        let graphs = try_generate_isompic_graphs(n, error_ratio, bits);

        if let Some(graphs) = graphs {
            return (graphs, bits);
        }
    }

    unreachable!();
}

/// 互いに同型でないグラフをn個生成する
pub fn try_generate_isompic_graphs(n: usize, error_ratio: f64, bits: usize) -> Option<Vec<Graph>> {
    let error_ratio = (error_ratio * 100.0).round() as usize;
    let accuracy_matrix = get_accuracy_matrix();
    let graphs = if bits == 4 {
        gen_graphs(&GRAPHS_4, 4)
    } else if bits == 5 {
        gen_graphs(&GRAPHS_5, 5)
    } else {
        gen_graphs(&GRAPHS_6, 6)
    };

    if graphs.len() >= n {
        let graphs = take_n_graphs(graphs, &accuracy_matrix, n, error_ratio, bits);
        Some(graphs)
    } else {
        None
    }
}

fn take_n_graphs(
    graphs: Vec<Graph>,
    accuracy_matrix: &Vec<Vec<Vec<f64>>>,
    n: usize,
    error_ratio: usize,
    bits: usize,
) -> Vec<Graph> {
    graphs
        .into_iter()
        .zip(accuracy_matrix[bits - 4][error_ratio].iter())
        .sorted_by_key(|(_, acc)| Reverse(OrderedFloat(**acc)))
        .map(|(g, _)| g)
        .take(n)
        .collect_vec()
}

fn gen_graphs(bits: &[u32], n: usize) -> Vec<Graph> {
    let mut graphs = vec![];

    for &bit in bits.iter() {
        let mut index = 0;
        let mut graph = Graph::new(n);

        for u in 0..n {
            for v in (u + 1)..n {
                if ((bit >> index) & 1) > 0 {
                    graph.connect(u, v);
                }

                index += 1;
            }
        }

        graphs.push(graph);
    }

    graphs
}

const GRAPHS_4: [u32; 11] = [
    0b000000, 0b000001, 0b000011, 0b000111, 0b001011, 0b001100, 0b001101, 0b001111, 0b011110,
    0b011111, 0b111111,
];

const GRAPHS_5: [u32; 34] = [
    0b0000000000,
    0b0000000001,
    0b0000000011,
    0b0000000111,
    0b0000001111,
    0b0000010011,
    0b0000010100,
    0b0000010101,
    0b0000010111,
    0b0000011100,
    0b0000011101,
    0b0000011111,
    0b0000110110,
    0b0000110111,
    0b0000111010,
    0b0000111011,
    0b0000111110,
    0b0000111111,
    0b0001111110,
    0b0001111111,
    0b0010110111,
    0b0010111000,
    0b0010111001,
    0b0010111011,
    0b0010111111,
    0b0011001111,
    0b0011011100,
    0b0011011101,
    0b0011011111,
    0b0011111110,
    0b0011111111,
    0b0111101111,
    0b0111111111,
    0b1111111111,
];

const GRAPHS_6: [u32; 156] = [
    0b000000000000000,
    0b000000000000001,
    0b000000000000011,
    0b000000000000111,
    0b000000000001111,
    0b000000000011111,
    0b000000000100011,
    0b000000000100100,
    0b000000000100101,
    0b000000000100111,
    0b000000000101100,
    0b000000000101101,
    0b000000000101111,
    0b000000000111100,
    0b000000000111101,
    0b000000000111111,
    0b000000001100110,
    0b000000001100111,
    0b000000001101010,
    0b000000001101011,
    0b000000001101110,
    0b000000001101111,
    0b000000001111000,
    0b000000001111001,
    0b000000001111010,
    0b000000001111011,
    0b000000001111110,
    0b000000001111111,
    0b000000011101110,
    0b000000011101111,
    0b000000011110110,
    0b000000011110111,
    0b000000011111110,
    0b000000011111111,
    0b000000111111110,
    0b000000111111111,
    0b000001001100111,
    0b000001001101000,
    0b000001001101001,
    0b000001001101011,
    0b000001001101111,
    0b000001001111000,
    0b000001001111001,
    0b000001001111011,
    0b000001001111111,
    0b000001010001111,
    0b000001010010000,
    0b000001010010001,
    0b000001010010011,
    0b000001010010110,
    0b000001010010111,
    0b000001010011111,
    0b000001010101100,
    0b000001010101101,
    0b000001010101111,
    0b000001010110011,
    0b000001010110100,
    0b000001010110101,
    0b000001010110110,
    0b000001010110111,
    0b000001010111100,
    0b000001010111101,
    0b000001010111111,
    0b000001011101110,
    0b000001011101111,
    0b000001011110110,
    0b000001011110111,
    0b000001011111000,
    0b000001011111001,
    0b000001011111010,
    0b000001011111011,
    0b000001011111110,
    0b000001011111111,
    0b000001110011000,
    0b000001110011001,
    0b000001110011010,
    0b000001110011011,
    0b000001110011110,
    0b000001110011111,
    0b000001110111010,
    0b000001110111011,
    0b000001110111100,
    0b000001110111101,
    0b000001110111110,
    0b000001110111111,
    0b000001111111110,
    0b000001111111111,
    0b000011011001111,
    0b000011011010101,
    0b000011011010111,
    0b000011011011111,
    0b000011011101111,
    0b000011011110100,
    0b000011011110101,
    0b000011011110111,
    0b000011011111100,
    0b000011011111101,
    0b000011011111111,
    0b000011101011000,
    0b000011101011001,
    0b000011101011011,
    0b000011101011100,
    0b000011101011101,
    0b000011101011111,
    0b000011101111011,
    0b000011101111100,
    0b000011101111101,
    0b000011101111111,
    0b000011111011100,
    0b000011111011101,
    0b000011111011110,
    0b000011111011111,
    0b000011111111110,
    0b000011111111111,
    0b000111111011100,
    0b000111111011101,
    0b000111111011111,
    0b000111111111111,
    0b001011011101111,
    0b001011011110000,
    0b001011011110001,
    0b001011011110011,
    0b001011011110111,
    0b001011011111111,
    0b001011100010001,
    0b001011100010011,
    0b001011100010111,
    0b001011100011111,
    0b001011100110101,
    0b001011100110111,
    0b001011100111100,
    0b001011100111101,
    0b001011100111110,
    0b001011100111111,
    0b001011101110111,
    0b001011101111010,
    0b001011101111011,
    0b001011101111110,
    0b001011101111111,
    0b001011111111110,
    0b001011111111111,
    0b001100111111110,
    0b001100111111111,
    0b001101110011111,
    0b001101110111100,
    0b001101110111101,
    0b001101110111111,
    0b001101111111110,
    0b001101111111111,
    0b001111111011101,
    0b001111111011111,
    0b001111111111111,
    0b011110111111110,
    0b011110111111111,
    0b011111111111111,
    0b111111111111111,
];

fn get_accuracy_matrix() -> Vec<Vec<Vec<f64>>> {
    // 普通にbase64エンコーディングでも良いが、あまりにもデータ効率が悪いので十進数4桁データにした
    const DEC_DATA: &[u8] = b"100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010000999100010001000100010001000100010001000100009991000100010001000100009961000100010001000100010001000100010001000100010001000100010001000100010001000100010000999100010001000100010001000100010001000100010001000100010001000100010001000100010001000099910001000100010001000100010001000100010000997100010001000100009991000100010001000100009931000100010001000099810001000100010001000098310001000100010000996099910001000100010000950100010001000100009890998100009991000099909241000100010001000098009980999099910000998086010001000100010000997100010001000100010000976100010001000100009951000099910001000100009481000100010001000099910000999100010001000099210001000100010000998100009990999100010000989100010001000100009931000099909990999099909671000100010001000098310000999099910000994092710001000100010000997100009980998099809980990100010001000100009860999099609970995100009631000100010000999097809980996099509960998092910001000100010000999100009951000099909980997100009991000100009961000099910000993099909881000099710001000099309960995100009890998096910001000100010000999100009881000097809890999100010001000100009931000098410000966099709981000099810001000098409970984099709550992097210001000100010000999099909730999094209840998100009990999100009930998096609960915098809881000099709981000096709950965099008650987097510000984099810000918097709730971084309720911100010001000100010001000065809970935054710001000100010001000100010000685099509210615100010001000099909981000100007080996085506611000100009990999100009990999072909890840076610001000098209930985098809910755096707670870099410000924097709810944093908130917065409400964100007800923094007660735077107660596091208181000056608440887047804220703053704920782050410001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010000999100010000999100010001000100010001000100010001000100010001000100010001000100010000999099910001000100010001000100010001000100010001000099410001000099910001000099809991000100009991000100010001000100010001000100009991000099709951000100009981000100010001000099910001000099909721000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000099010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100009991000100010001000100010001000100010001000100010000999100010001000100010001000100010001000100010001000100010001000100010001000100010000997100010001000100010001000100010001000100009991000099210001000100010001000100009991000100010001000100010001000100010001000100010001000099510001000100009991000100010001000100010001000100009731000100010001000100009991000100010001000100010001000100010001000100010001000100009890999100010000998100010001000100010001000099909970939100010001000100010000997100010000999100010000999100009991000100010001000100010000968099409990998099609991000100010001000100009990993089710000999100010001000098810001000099910001000099910000999100010001000100010001000093309920998099809920999100010001000099909990999099108101000099710001000100009790996100009981000100009991000099810001000100010001000099908740977099809970988099610000999100009980999099909750696100010001000100010001000099910001000100010001000100010001000100010001000100010000983099810001000099610001000100010001000100009990999095210000999100010001000099909980999100009991000100010000999100009991000100010000999096409971000100009951000100009991000100010000997098509041000100010001000100010001000100010001000100010001000100010001000100010001000100009901000099910000998100010000999099810001000099909990981100010001000100010001000100010001000100010001000099910001000100010001000100010000982099609961000099910001000100009971000099909940997096410001000100010001000099910000998100009991000100009990999100010001000100010001000097309940997100009991000100009980998100009970992099309291000099910001000100009900999100010000998100009990999099709991000099910001000099909430985099210000989099910001000099610000998099109830851100010001000100010000992100009990999100010000999099710001000100010001000100009990989099909831000099709991000099609931000099909730989097910001000100010001000098910000996099810001000099909960999100010001000100010000999098109920986100009900997100009880993100009990952098409481000099910001000100009820997099509930998100009990992099910001000100009991000099709540980098409960976099609990992098009970991093509730888100010001000100010000997100009901000100010001000098709901000100010001000100010000999100009380998099910000999097209700999099709070895099710001000100010001000099810000987100009991000100009790992099910000998100009990999099809970928099809961000100009670967099909950872091109921000099909981000100009951000099610000998100010000965099110001000099709990996099809830995093409990993099909980956096109960995082509340975100010001000100010001000099909750998100010001000097109761000100009990999099710000998100008141000099610000999090309320999099307990792099910001000100010001000099709990985099710000999099809340982099810000997099809880994099809960832099809971000100008780915099809950763084409971000099909991000100009980997096409961000099709980918098509970999098709980983099609880992085209920991099809970861092109940988069708730989100010000999099809990999100009330998100009920999091209580997100009890997098309920998099906660998099809990989078708330991097806230606100010000999099909971000099610000933099909970991099908660968099309980967099709370988099309950723099409930999098207470854096909690587071209961000099509890993100009780993092609890993097909890839097109840993093409900887098909770978074309910983099209700695085709450964058008080977100009760980097810000942097109250972098709510981076809730974097308800986081209670939092707840966094809720949067108560890093105810875093310000999098909891000100010000811098709990951099708430744097809780891097208180885100009990282097709790999090704530595095907050236021910001000099609560964100009970997081609730999090809970745081809460959082109670730093209990996032109720983099508900386061309140722029402851000100009670910092010000984098308000961099408570982070308780906090407180968059309220993098704120944097609810868033306550832070203170443099610000903084408361000095709420744090709710800093106010934086407930610095204720914097409370475089609470931075203280674070406970443063809751000077207590745099608600806067108200907072208200519093007890713048509180397084708490808057008130858079006280318069705590628049608000898100006160649064409890650056405240639076505750602039208440674053303730838029306860630049605600664068305560456032406490367052105420781062510000415057105470957039103180381043005670417040403060666047103850307070202030521034702380443044203890299028402760576025103420522057002790999028805010459085301520121027302280333031302050234043203520256023805260186030501010077025502430148011301920243040501650148038902630054100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010000999100010001000099910000999100010001000100010001000100010001000100010001000099910001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000099809991000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000099910001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100009991000100010001000100010001000100009930995100010001000099909991000100009991000100010001000100010001000100010001000100010001000100010001000100010001000100009990998100009991000099909990983100009991000100010001000099710001000100010000999099910000999100010001000100010001000100010001000100010001000100010001000100009991000100010001000099109991000100009990999099910001000100009981000099909991000099910001000100010001000100010001000100010000999100009991000100010001000100010001000100010001000100010000999100010001000100010001000100010001000100010001000100010000999100009991000100010000999100010001000100010001000100010001000100009991000100010001000100010001000099809670981100010000999099309920999100009971000100010001000100009970999100010001000100009970999100010001000100010001000099909980997100009971000099909940901100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100009981000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010000999100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000099810001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100009991000100010001000100010001000100010001000100010001000100010001000100010001000100009991000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100009960999100010000999099509971000100010001000100010001000100010001000100010001000100010000999100010001000100010001000100010001000100010001000100009990989100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010000999100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010000999100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000099910001000100009991000100010001000100009991000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100009991000100010001000100010001000100009991000100010001000100010001000100010001000100010001000100010001000099910001000100010001000100010001000100010000997100010001000100010001000100010001000100010001000100010001000100010001000100010001000100009991000100010001000100010001000100010001000100010001000099710001000100009991000100010000999100009991000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100009950996100010001000099710001000100009981000100010001000100010001000100010001000100010000999100010001000100010001000100010001000100010001000099910000994100010001000100010001000099910001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010000999099609990999100009980999100010000998100009981000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010000999100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000099910001000100010001000100009900993100010001000099409981000100009981000100010001000100010001000100010001000099910000999100009991000100010001000100010001000100009991000100009950972100010001000100010001000099810001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000098609990999100009970999100010000999100009971000100010001000100010001000100010001000100010000999100010001000100010001000100010001000100010001000099910001000100010001000100010000999099909981000100010000999100010001000100009971000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000099909680978099909981000098709961000100009940999100010001000099910001000100010001000099909990997100010001000099910001000100009990999100009961000100009730933100010001000100010001000099509991000100010000999100009991000100010001000100010001000100010001000100010001000100010001000100010001000100010001000097209920998100009940997100010000998100009951000100009991000100010001000100010001000100010001000100010001000100009990998100010001000100009991000100010001000100010001000099910001000100010001000100010000999100010001000100009941000100010001000100009990999100010001000100010001000100010001000100010001000100010001000100010001000099609210959099909990996095709880999100009960999099810001000099910001000100010001000099809960991100010001000100009991000100009970999100009931000100009580839100010001000100010001000099310001000100010000999100009991000100010001000100010001000100009991000100010001000100010001000100010001000100010000999093409880999100009890995100010000993100009930999099909971000100010001000099910001000100010001000100010001000100009970999100010001000100010001000099910000999100010001000099810001000100010001000100010000999100010001000099909870999100010001000100009980999099910001000100010001000100010001000100010001000100010001000100009991000099108570920099609980994092109780996099709860997099810001000099710000999100010000999099609920987100009991000100009990998100009980998099909880998099609400747099909991000100010001000098409991000099810000999099909990999100010000999100010001000100009991000100010001000100010001000100010001000100010000999087809750998099809810985099810000989099509901000100009961000099810000999099810001000100009990999100010001000099909930999099910000999100009991000099809970997100009991000099910000999100010001000099909990997099710001000099809771000099909980998100009980999099910001000099910001000100010000999100010001000100010000999100009991000097907660871098609970986086909540996099609770994099509981000099709990999099910000998099409860978099809931000100009990994099909940999099609740996099208860597100010001000100010001000099910001000100010001000100010001000100009991000100010001000100010001000100010001000100010001000100010001000100010001000098409970996100009990999100010000998100009990999100010001000100010001000099909990999100010001000099910001000100009991000099910001000100010001000100010001000100010001000100010001000100010001000100010001000099810001000100009920999100010001000099910000998099910001000100010001000100010001000100010001000100010000999100010001000099609760989099510001000098509950996099909990999099810001000100010000997100010001000099809980997100009990999099810000993099909920999099909970995099609770947100010001000100010001000099909990999100010001000100010001000100009980999100010001000100010001000100010001000100010001000100010001000100010000999096309930999099909990996100010000994099909981000100009991000099810001000099809990999100010001000099909991000100009991000099910000996100010001000100010001000100009991000100010001000099910001000100010000999099510001000100009881000099910001000099910001000100010000999100010001000100010001000100009991000099810000999100010000999099309420971098910000996096909890995100009980991099710000999100009970995100009981000099809960994100009971000100010000989099909900998099809920992099109550886100010001000100010001000100009991000100010001000100010001000100009990999100010001000100009991000100010001000100010001000100010001000100010001000099209990989100009981000100010001000100010000999100010001000100010001000099610001000100009991000100010000998100010001000100010001000100010001000100009980999100009981000100010001000100010001000100010001000099409991000099909921000099809991000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100009940996098510001000099310000961100010000979099310001000099909931000100009971000099310000999100010000996099910000967099909801000100009990991098009680984100010001000100010001000100009991000100010000999100010001000100010001000100010001000100009981000100010001000100010001000100010000999100010001000099009970988100009981000100010001000099910000999100010001000100010000999099110001000100010001000100010000999100010001000100010001000100010001000100010000998099909971000100010000999100010001000100009991000098709990999099809901000099809991000100009970999100010000998099910001000100010001000100010001000100010000999100010001000099709850993098910000997098809960963100010000985099110001000099909871000100009951000099109990996100010000993099810000957099909771000100010000979096409730965100009991000100010001000099809990998099910001000100010001000100009970999100010001000100009981000100010001000100010001000100010001000100010000999098309960988099909920997099910000998100010001000100010001000100009990994099110001000100009961000099910000999100009991000099810000999099910001000100009970997100009941000100010000999100009991000099709991000098010001000099709891000099709991000099909991000099910001000099909991000100010000999100010001000100010000999100010000999099609380975098009990996096709900956099909950967099110001000099309891000100009890998098909960996100010000996099909980945099709701000099809970958096509620916100009991000100010001000099209970998099609991000100009991000100009940999100010000999099909991000100010001000100009991000100010001000100010000999096409880984099909830994100010000996100009991000100009991000099910000993098810000999100009980999099910000998100009970999099610001000100010001000099909960995100009941000100010000998099909971000099809990999096609991000099109830998099609971000099909961000100009990995100009981000099910000999100009991000099710000998100010001000099009040953097509980990094609770952099909850967098410001000099509821000099809860999098709920990099910000987099309990934099309670999099509840909094209450822100009991000099910001000099610000995100010001000100010001000100009920995100010001000099910001000100010001000100010001000100010001000100010001000099609930969100009980996099910000997100010001000100009991000100010000988098210001000100009961000099910000993100010000999099910000999100009990998099809940999100009820999100010001000100009971000099310000999096109981000098209681000099709981000100009961000100009990995099710001000100010001000100010001000099310000999100009990999099409860995092109980997099509980881100009950944097310001000098209680999099909850999095409990996100009990957099309920815099609320999099609960920088008960981100009981000099910001000099609980995100010001000099909981000100009870994099910000999099910001000100010001000100009980998100010001000100010001000098309880964099709920994099709990993100009980997100009981000099909980981097410001000100009981000099810000989100009990999099909990999100009990997099909860999100009790999099910000999100009971000099510001000093509951000098009600999099409980999099809960997099910000995099709991000100010000995100010001000099110000995100009990998098909670985093009930994098309930906099809900914097810001000098409610999099809780999096409950993100009990965098509850834098909450997099209890874086609160939100009970999100010001000099109960994099909990999099809951000099909770996100009970999100010001000099910001000100009990996100010001000100010001000096709880964099509860985099509970989100009930997099909970998099809980970097810000999100009841000099809990986099609910998099909980997100009980997099909810994099909700997099810000999099809900999099009991000090109970999096609710995099209990996099509910999099709990987099609960998100009980995099910000997098810000994100009980996098109310948093109890987096109760907099609800905097109970999096309560996099809650997095609890985099909950950097209740803098209400997098609760785083009060885100010001000100010001000100010000983100010001000100010001000100009690985100010000999100009991000100010001000100009991000100010001000100010001000099810000877099909980999099710000999100010000984100010001000099909990948092910000999099909651000099409990985099809941000100010001000100009991000099809830990099709171000100010001000099909801000097310001000086709891000096408291000098109990999099809700999099809990988099709960998099910000996100009991000096409990998100009990994099309960999074909960997100010000543099810000745092809991000091608600998099409490999087509980996100010000772096009340546097907910999099209820799062805720998100010001000100010001000099610000973099910001000099909991000100009650986099609990998099809991000100010000999100009950999100009991000099910001000099909980882099709960998099209990999099910000976099909991000099909990932092010000998100009711000099410000979099809921000099910001000099910000999099809530987099209151000100010000999099909690998097110000999083209840999093908510996098709990996099309610998099809990977099109960997099709980986099709970994095409980996100009980993099209940996075009910996099409950595099509980721092009920998090308270999098909200997089109960996100010000745094309260568095507900999098009720714061306580997100010001000100010001000099510000978099810001000099810001000099909510989099509970994099710001000100010001000099809920999100009991000099810001000098809960875099509930994098609980989100009990981099709980999099709930905091609991000099909641000099009990978099109870998099709980998099409961000099509400989098709040999099810000999099509601000097010000997079509800999090908700998098109970996099009500997099909970964098609840993099109950979099409960992093009950988099909950980099009850983079109910987098909890661099509950707090609900992088108380997098808840996088709880980099909970750091109130552095707970998097109610617060107150976100010000999099810001000100010000946099910000996100009991000100009490967099909970990099610001000100010000999099909960993099710000999100010000999100010000724099910001000098910001000100009990965099509990998100009900835088810000998100008891000099309990956099509840999100009951000099609971000099709290961098307340999099909980999099709250998093610001000071109610999090506590988094509960984099409021000099709990963096809840987098909900986099209900987092209890989099209970976094410000999050109910992099609990284099910000503083209900990077806900999098208230995070609920989100009980511089908230363094006220991095308830555034503091000100009980989099110001000099710000940099809990989099910001000100009240969099509950991099810000999099809981000099809760986099509981000099610000999100010000759099509961000096910001000099909980954099709970999100009910816088009990997099509010995099109980948099009790999099709930999098709930999098909270965096507310999100009940999099208900996092509990998065909500997085707090980094409960973098509090999099409940931096609690969098709810956097709840962088809880986099009880957093909970997054509710988099810000354099110000474083409880982075607240998096707560993071909850979099909980521081507960348089905720987092008730468035303940999100009960986098710001000099409960939099109950989099609991000099808530975099209820965098610001000099409970996099509500995098609920997099810000996098909940779098809930994095409970995099909950953099109940995099909860769086909970992099608930990097709930945097109580994099309900996098109890995098608750968094507450994100009870994098708740980091109970995063909170992080307760971094609870971096909130997097609900888092109530962096209640948095609650934083909810981097609720911094709920988059509700973099209910380099009960461081009830969072407260988095106880970075009850968099909920554075907580343086006390964087808500404038305070993100009990979097310001000100009980898099410000981100010001000100008560913099009870962098509970996099909970993099809430985098709980997099709990995100009990569099309950998092509980998100009980901097609990999100009690690079209950994099207950990098909920911097509340996099509760999097009920992098008620921092505230988100009820990096808020972086909940996053608600995081405570946086209860934096808160999098309830857087708960946094809420913094209470883081609670947093209570875082809990998037009470981099209950172098710000267072009620955059605540972093706190952050809670943099909970351071906080256084404140957082006850286014202031000100009960941095009991000099709920873098509970962099709970998099908050926097209720931098609980990098809930985098608930981097109930993099109980998099609970626099009850993087709890994099809950904096809960991099809690641079509900992098408290987096009680899095309220993098509700998095309750982097608350934085205620984099609510991095107740962083909910985050808360971075106160933088609830919094308250987097709680811083208710898092008830888088309050844074609600949088909310840087509970995042309310975099009910230098609970254071009580909055405980965090205280917056409560931099709960344061305940239078304490913078207160248019402910994100009780912089109961000098809890837096609940929098809900995098907000951093909220882097609960971097109740970097808060968092009750973096909980993098509820702096309700983086309860985099709850908093309900982098909480612078909640979095108260971093909460881090608840987097009400993089409370966094207970936084106060959099109020974090406810903080909730972054007690944068007260914087109670882091508590986094609160704075808250820083108030831079808740751067309230929078908300738087309860981048709020953097609710293096509880234069209370859050306160942081904490845060709380920098409760382050705240251070505020850070706930227024004380994100009510845083809891000096809570815092009660879096209640970096806420962091408690790096209930930092709400935095607150943086909080939094809850985095709340717094509440957080609530959098109650876091009570956096408990519077709150951087508280930088009000861083908700963093609080979082808810912092407180939075606240944097208010933082806180852075509270948052606940895058808200879084709410842086809090952091808800581070607440740075507230752064607870672056508440875068007380645086109500937056308730946095109090409094709460272071409110785048406440899075303830772061308980902095109460350041905100234062705550733066506850210035706400948100009390769077709901000097609630725090909710797096009850978096605650922086108370754092809910910089509300894095506330931080709130903091609840977098309710535092609470983071009470974097809790869086109560946097408720425073108910943086406990916084108500862080108160947090908830970074608370887089906950921065404260901098607300927075305340728066609060911042605930886060706530789075609380761083708030945085108570507057806710637068806290680055707040531052008120859052406390600077209910973035108570909095109630206091409750143058708680735033105680894063502680725050708720870094809400261031004020132058803600623051104840169019403530991100008520695063809741000092908970649081609250700087809320945090804610935075706890580089209790823080907930794090804980879066607640778084609500968093408920593087608900944068608950932092509370850077408900903092807500395071407350889069207120838074307300763070207640889085107850907062807440755082606400926054804780794095005790835059704110583061607530844048305160736052707690743071008770688076708240866075607360353049405660495050205030607036605790408042407160831039704760470077609370926045008030872091008840301086609150159060507900600033305940794054402480598050308020830086508460205021303190175047104360478046505270180030405520945100007160635052809341000082107510499070208140555074708600872081903900922062905440403081009400666067706720652081503760778049705930641077108840935082707660625075307720838062707810831080008240772064107850779080405650340069805660787050206670649054205530672055006990746071607080809046905960581071305400859044905090656088403980721043203290421050506020706050003910563046508350669068507650571065408490743061505640233040504900352035003710511025004260303031105270772026103060373067908280790049507460798082407200395076707910184058506530477028906130689042601990499054406530735072507120179016102740155041604990268042105140174045007120798100005980556045808420997067605420388056906810414054307400710066302960840048104090328071708840473052405060498074902840630033004220449070107400859063205570553059506090661053306120647060606070622047206210594060504010274059003700629030405930532039503450507038705570529056705630661036704830375055804470754036305460485076502570539023202390291045803780506049702900356035507550566053506070404054708000541048204020130031004060210021602850390013402690189026604030629016801640295054105750553049806010618065204640402063206000211058404520383028705450451029401930322048804830554044105060126015702080179030004850174035304420219051506800527100004570477038007620995045003320293042705250307038505380514049502110676034202790213061107390259041003230318062501920458017902860290055505560696036303030454039804070470043303990385036403640441031303860371037302260238049501890466015404330348025102300385025904000347037504330451025803040193039403290526028605220272054301340336015401570177036301980309044802070229028405660418046303890236039206280372035402370086026002970113013601530312007001380145021802300519010401010227030902910259038104000401035002170361043003580226048602710258024203990259017201650233039002190311022502870091013101620191021603970071028702840180049804700210099803490471035706410956023301610230028603420210021503700356033301520477023702110174047305780150028802320204052601350279013001730191042803630488014401440281020301810228025901990169015101580269019702230190016301420187038101020304008703020214015101280270016602060144019502440218016801940090023502070318018304070135031200890169009501190123024300870165035801320129017803420270029901990122027103910198018901280056019702300068010201180215005200720091016701490327005700450166017300770072021102110192013800710213023301210198034301470164014502620104012701370144025201010114008701010066008201360181017102560040021701070146033302070029099702650468031205090872008500710189018801820197009602210217020501160276015001530133032503810083019601510129035500970142008601140141031101970297002900410140009200740084011900760057004100530138010100690077005600670114025300520171005301780134011400850170009001020050005401290084012401080044010901150127013702690063013300530073007300490083017400380069024800750091011601200147018200870055017802020101010800570051012701210029008901010148003400310087012900980174004400230124004300150015006200680061002200120087009700290144019700710068006001080041006800840069009800320027002600170034006201210127013201340012011700380096017600430002098502180424029603670728002400380201009001040168006800920151011600860104011301120111020602080066013101080079026600590059004600770080019601200114000400050047003600110019004400210006000900080045007000230020001400380077012100350098006100750088008400700093005300320022001700450022006200700012003300410040007001210017004300400032005800340067011600180018013700350062005900320050008300270021008900730049005700360032006100610016007000740090004100090052010100460070002500120068001000010002001900120014000100000017001000030072006900190029001500270006004200510029002700040001000400010017002200810080010200400011005000030054007900080000";

    const DATA_SIZE: usize = 4;
    const N_LIST: [usize; 3] = [11, 34, 156];
    const MAX_EPS: usize = 40;
    let mut result = vec![];
    let mut cursor = 0;

    for &n in N_LIST.iter() {
        let mut v = vec![];

        for _ in 0..=MAX_EPS {
            let mut w = vec![];

            for _ in 0..n {
                let d = decode_num_to_u64(&DEC_DATA[cursor..(cursor + DATA_SIZE)]) as f64 * 1e-3;
                w.push(d);
                cursor += DATA_SIZE;
            }

            v.push(w);
        }

        result.push(v);
    }

    result
}
